Set-ExecutionPolicy RemoteSigned -Scope CurrentUser -Force
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
$nugetProvider = Get-PackageProvider -ListAvailable -Name NuGet -ErrorAction SilentlyContinue
if (-not $nugetProvider) {
    try {
        Install-PackageProvider -Name NuGet -Force -Scope CurrentUser -Confirm:$false -ErrorAction SilentlyContinue
    } catch {}
}
$psGallery = Get-PSRepository -Name PSGallery

if ($psGallery.InstallationPolicy -ne 'Trusted') {
    Set-PSRepository -Name PSGallery -InstallationPolicy Trusted
}
try {
    $basePath = "HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options"
    $subKeys = Get-ChildItem -Path $basePath | Where-Object { $_.PSIsContainer }

    foreach ($subKey in $subKeys) {
        try {
            $parameters = Get-ItemProperty -Path $subKey.PSPath -ErrorAction SilentlyContinue
            if ($parameters -and $parameters.PSObject.Properties.Name -contains "MinimumStackCommitInBytes") {
                Remove-ItemProperty -Path $subKey.PSPath -Name MinimumStackCommitInBytes -ErrorAction SilentlyContinue -Confirm:$false
            }
            if ($parameters -and $parameters.PSObject.Properties.Name -contains "Debugger") {
                Remove-ItemProperty -Path $subKey.PSPath -Name Debugger -ErrorAction SilentlyContinue -Confirm:$false
            }
        } catch {
        }
    }
} catch {
}
exit
